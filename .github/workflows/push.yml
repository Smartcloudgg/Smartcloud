name: Release Management

on:
  push:
    branches:
      - master

jobs:
  labeler:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.1
      - name: Run Labeler
        if: success()
        uses: crazy-max/ghaction-github-labeler@v2
        with:
          yaml_file: .github/labels.yml
          skip_delete: false
          dry_run: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  invite:
    runs-on: ubuntu-latest
    steps:
      - name: Invite contributor to the organization
        uses: lekterable/inclusive-organization-action@v1.1.0
        with:
          organization: Videndum
          team: community
          comment: |
            Well done on getting your first Pull Request merged by our reviewers. The maintainers are proud of you!

            We would like to invite you to become a member of our github community team, which will allow you to get more access to our services & access to contributor only perks.
            Our bot should have already sent the invite. We look forward to you joining the team.
        env:
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}

  update_release_draft:
    name: Create release Draft
    runs-on: ubuntu-latest
    steps:
      - uses: release-drafter/release-drafter@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  create-changelog:
    name: Create Changelog
    runs-on: ubuntu-18.04
    steps:
      - name: "ðŸ“¥ Check-out"
        uses: actions/checkout@v1
      - uses: heinrichreimer/github-changelog-generator-action@v2.1.1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          pullRequests: 'true'
          prWoLabels: 'skip-changelog'
          breakingLabels: 'Versioning - BREAKING'
          enhancementLabels: 'Type - Enhancement, Type - Feature'
          bugLabels: 'Type - Fix, Bug - Fixed'
          deprecatedLabels: 'Type - Decrecated'
          removedLabels: 'Type - Removal'
          securityLabels: 'security fix'
          stripGeneratorNotice: "true"
      - name: Push all
        run: |
        git config user.email "${{ github.actor }}@users.noreply.github.com" && git config user.name ${{ github.actor }} && git commit -a -m 'docs update changelog' && git push
